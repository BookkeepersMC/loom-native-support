name: Release
on: [workflow_dispatch] # Manual trigger

jobs:
  build:
    runs-on: ubuntu-22.04
    container:
      image: mcr.microsoft.com/openjdk/jdk:17-ubuntu
      options: --user root
    steps:
      - run: apt update && apt install git && git --version
      - run: git config --global --add safe.directory /__w/loom-native-support/loom-native-support
      - uses: actions/checkout@v4
      - uses: actions/checkout@v4
        with:
          repository: 'BookkeepersMC/m2'
          path: m2
          ref: master
          token: ${{ secrets.GIT_PAT }}
      - uses: gradle/actions/wrapper-validation@v3
      - run: ./gradlew build publish --stacktrace

      - uses: EndBug/add-and-commit@v9.1.4
        with:
          add: './com/'
          default_author: github_actions
          cwd: "./m2/"
          message: "Publish loom native"
